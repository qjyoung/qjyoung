<html lang="en">
<head>
    <meta charSet="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>公众号：程序员阿诺</title>
    <style>
        a:link, a:visited, a:active {text-decoration: none;color: blue;}  a:hover {text-decoration: underline;}  .board {position: relative;float: left;margin: 5px 17px 5px 17px;padding: 5px 17px 5px 17px;}  .badge {position: absolute;font-size: 17px;width: 23px;height: 23px;line-height: 23px;text-align: center;}  .up {top: -12px;right: -12px;}  .down {bottom: -12px;right: -12px;}  .my-button {position: relative;cursor: pointer;}  .my-button:active {padding-bottom: -1px;}  .item-x {display: none;}  .item:hover > .item-x, .item-x:hover {display: inline-block;}  .title {position: relative;}  .title:hover {color: transparent;}  .edit {background-color: transparent;display: none;position: absolute;top: 0;margin: 0;padding: 0;width: 100%;height: 100%;font-family: inherit;font-size: inherit;font-weight: bold;border: none;outline: none;}  .title:hover .edit {display: block;}
    </style>
    <script src="x.js"></script>
    <script src="calendar/lunar.js"></script>
    <script src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script>
</head>
<body>
<div id="app" style="width:100%;height: 100%;">
    <tools-board v-bind:tool_groups="toolGroups"></tools-board>
    <tools-board v-bind:tool_groups="[countdown]"></tools-board>
</div>
</body>
<script>
  let type_tool = 1;
  let type_countdown = 2;
  let colors = ['AliceBlue', 'AntiqueWhite', 'Aqua', 'Aquamarine', 'Azure', 'Beige', 'Bisque', 'BlanchedAlmond', 'BurlyWood', 'CadetBlue', 'Chartreuse', 'Coral', 'CornflowerBlue', 'Cornsilk', 'Cyan', 'DarkCyan', 'DarkGoldenRod', 'DarkGray', 'DarkKhaki', 'Darkorange', 'DarkSalmon', 'DarkSeaGreen', 'DarkTurquoise', 'DeepPink', 'DeepSkyBlue', 'Feldspar', 'FloralWhite', 'Fuchsia', 'Gainsboro', 'GhostWhite', 'Gold', 'GoldenRod', 'GreenYellow', 'HoneyDew', 'HotPink', 'IndianRed', 'Ivory', 'Khaki', 'Lavender', 'LavenderBlush', 'LawnGreen', 'LemonChiffon', 'LightBlue', 'LightCoral', 'LightCyan', 'LightGoldenRodYellow', 'LightGrey', 'LightGreen', 'LightPink', 'LightSalmon', 'LightSeaGreen', 'LightSkyBlue', 'LightSlateGray', 'LightSteelBlue', 'LightYellow', 'Lime', 'LimeGreen', 'Linen', 'Magenta', 'MediumAquaMarine', 'MediumOrchid', 'MediumPurple', 'MediumSeaGreen', 'MediumSpringGreen', 'MediumTurquoise', 'MediumVioletRed', 'MintCream', 'MistyRose', 'Moccasin', 'NavajoWhite', 'OldLace', 'Olive', 'OliveDrab', 'Orange', 'OrangeRed', 'Orchid', 'PaleGoldenRod', 'PaleGreen', 'PaleTurquoise', 'PaleVioletRed', 'PapayaWhip', 'PeachPuff', 'Peru', 'Pink', 'Plum', 'PowderBlue', 'Red', 'RosyBrown', 'Salmon', 'SandyBrown', 'SeaGreen', 'SeaShell', 'Silver', 'SkyBlue', 'SlateGray', 'Snow', 'SpringGreen', 'SteelBlue', 'Tan', 'Teal', 'Thistle', 'Tomato', 'Turquoise', 'Violet', 'VioletRed', 'Wheat', 'White', 'WhiteSmoke', 'Yellow', 'YellowGreen',];
  new Vue({
    el: '#app',
    components: {
      toolsBoard: {
        props: ['tool_groups'],
        data() {
          return {
            name: "乔健勇",
            url: "https://qjyoung.github.io",
            date: "xxxx-10-05",
            desc: "xxxx==当年"
          }
        },
        template: '<div>\
                        <div class="board item" :style="{backgroundColor:group.background}" v-for="group in tool_groups">\
                            <h1 v-bind:class="!group.custom?\'\':\'title\'">{{group.title===""?"请输入标题":group.title}}\
                                <input class="edit" placeholder="请输入标题" v-model="group.title" v-if="group.custom"/>\
                            </h1>\
                            <p v-if="group.type===type_countdown" style="height: 150px;padding-left: 20px">\
                                <span v-html="group.today"></span>\
                            </p>\
                            <ol style="margin-bottom: 22px">\
                                <template v-for="tool in group.tools">\
                                    <li class="item" style="padding-right: 2px">\
                                        <a :href="tool.url" target="_blank"><span v-html="tool.name"></span></a>\
                                        <span class="my-button item-x" style="position: absolute;margin-left: 1px" v-if="tool.custom" @click="group.tools.splice(group.tools.indexOf(tool),1)">❌</span>\
                                    </li>\
                                </template>\
                            </ol>\
                            <div class="item-x" style="position: absolute;left:20px;width: 92%;bottom: 2px" v-if="group.custom||group.type===type_countdown">\
                                <template  v-if="group.type===type_countdown">\
                                    <input type="text" style="width: 40%" placeholder="日期" v-model="date"/>\
                                    <input type="text" style="width: 40%" placeholder="描述" v-model="desc"/>\
                                </template>\
                                <template  v-else>\
                                    <input type="text" style="width: 40%" placeholder="链接" v-model="url"/>\
                                    <input type="text" style="width: 40%" placeholder="名称" v-model="name"/>\
                                </template>\
                                <span class="my-button" style="position: absolute;margin-left: 3px"  @click="newItem(group)">✅<span/>\
                            </div>\
                            <div class="badge up item-x" v-if="group.custom">\
                                <span class="my-button" @click="tool_groups.splice(tool_groups.indexOf(group),1)">❌</span>\
                            </div>\
                            <div class="badge down item-x" v-if="group.type!==type_countdown">\
                                <span class="my-button" @click="newGroup(group)">➕</span>\
                            </div>\
                        </div>\
                    </div>',
        methods: {
          newGroup(previousGroup) {
            this.tool_groups.splice(this.tool_groups.indexOf(previousGroup) + 1, 0, {
              title: "请输入标题",
              custom: true,
              background: colors[Math.ceil(Math.random() * colors.length)],
              tools: []
            });
          },
          newItem(group) {
            let date = '', isLunar = false;
            let year = 'xxxx', month = 'xx', day = '';
            if (group.type === type_countdown) {
              if (/[\u4E00-\u9FA5]/.test(this.date)) {
                isLunar = true;
                let strings = this.date.split("年");
                if (strings.length > 2) {
                  alert("error date");
                  return;
                }
                if (strings.length === 2) {
                  year = strings[0] === '' ? year : strings[0];
                }
                if (!/^xxxx$|^[1-9]\d{3}$/.test(year)) {
                  alert("error year");
                  return;
                }

                strings = strings[strings.length - 1].split("月");
                if (strings.length > 2) {
                  alert("error month");
                  return;
                }

                if (strings.length === 2) {
                  month = strings[0] === '' ? month : strings[0];
                  let _month = month;
                  if (_month !== 'xx') {
                    _month = _month.replace('闰', '');
                    if (_month.length > 2) {
                      alert("error month");
                      return;
                    }
                    if (_month.length === 2 && _month[0] !== '十') {
                      alert("error month");
                      return;
                    }
                    if (XXXUnits.indexOf(_month[_month.length - 1]) < 0) {
                      alert("error month");
                      return;
                    }
                  }
                }
                day = strings[strings.length - 1];
              } else {
                let strings = this.date.split('-');
                let length = strings.length;
                if (length > 3 || length === 0) {
                  alert("error date");
                  return;
                }
                day = strings[length - 1];
                if (length > 1) {
                  month = strings[length - 2];
                }
                if (length > 2) {
                  year = strings[length - 3];
                }
                if (!/^xxxx$|^[1-9]\d{3}$/.test(year)) {
                  alert("error year");
                  return;
                }
                if (!/^xx$|^1[0-2]$|^0?[1-9]$/.test(month)) {
                  alert("error month")
                  return
                }
                if (!/^(0?[1-9]$|^[1-2][0-9]$|^3[0-1]$)/.test(day)) {
                  alert("error day")
                  return
                }
              }
              date = [year, month, day].join('-');
            }
            group.tools.push({
              date: date,
              lunarDate: isLunar ? date : '',
              isLunar: isLunar,
              desc: this.desc,
              name: this.name || "空",
              url: this.url,
              custom: true
            });
          },
        },
      }
    },
    data: {
      toolGroups: [{
        title: "公众号-程序员阿诺",
        background: "pink",
        tools: [{
          url: "https://qjyoung.github.io/",
          name: "扫码关注&nbsp;<img src=\"./qrcode.png\" alt=\"公众号：程序员阿诺\" style=\"width: 90px;height: 90px\"/>",
        },
          {url: 'https://github.com/qjyoung', name: 'github'},
          {url: '', name: ''},
          {url: 'https://v.qq.com/x/page/n0536o6npn5.html', name: '踩着单车去拉萨'},
          {url: '', name: ''},
          {url: 'https://mp.weixin.qq.com/s/QaU5B0m4Oo-hhIigu10ehg', name: '北疆2872公里之旅'},
          {url: 'https://mp.weixin.qq.com/s/HARgAEd3G36cMgioiwA04A', name: '西藏，魂归之地'},
          {url: '', name: ''},
          {url: 'https://mp.weixin.qq.com/s/51b7n81DxyRjVoyyi2U-tA', name: '用vue写一个傻瓜式倒计时列表'},
          {url: 'https://mp.weixin.qq.com/s/UhyQ5lnaqfV0i-O90OEQEw', name: 'git补丁的妙用，将代码差异化发布到外网github'},
          {url: 'https://mp.weixin.qq.com/s/WSEz9CdUze8RNppATl6_kw', name: '这或许是封装的最优雅的Excel数据导出工具'},
          {url: 'https://mp.weixin.qq.com/s/gf5G484F_Jbi0Ppwyzaq-w', name: '究极效率，一行sql拿到全流程测试数据'},
          {url: 'https://mp.weixin.qq.com/s/X1R4ozZ_QmZZHa_2kCt0KA', name: '受宠若惊，竟被DDoS攻击了'},
          {url: 'https://mp.weixin.qq.com/s/gttv67UBfCn-JapSfzHMlA', name: '商城下单-三方支付-时序图'},
          {url: 'https://mp.weixin.qq.com/s/ZlK9vPLLkNFP73TPDrth5A', name: '借助lambda灵活控制事物粒度'},
          {url: 'https://mp.weixin.qq.com/s/nbzWbws4o53tO42WZMFynA', name: '注解、代理简化redis分布式锁-实现代码'},
          {url: 'https://mp.weixin.qq.com/s/ycdvhfzIP6Y_CpskCyrQmQ', name: '通用的区块链智能合约web3.go调用服务'},
          {url: 'https://mp.weixin.qq.com/s/KJv8m_1exKeMEU__pGR4Ug', name: 'docker快速搭建elk-2-解析Java、go、nginx日志'},
          {url: 'https://mp.weixin.qq.com/s/hoOZqeHwkvwWyP8BhCKP7Q', name: 'Git 多人协作，诸葛亮带你玩转cherry-pick 、rebase'},
          {url: 'https://mp.weixin.qq.com/s/ZrDaT1kMT30EDqBLi28lUA', name: '精简版-五颜六色的常用工具面板-基于Vue'},
          {url: 'https://mp.weixin.qq.com/s/fc9O0Yow6YQrhPepmCVHAw', name: 'SQL查看数据 - 借助view、group_concat节省你宝贵时间'},
          {url: 'https://mp.weixin.qq.com/s/dunLcQ8O1gfwAf6jb4S1mA', name: '用VUE做一个常用工具面板'},
          {url: 'https://mp.weixin.qq.com/s/IkQVKnA-iHG_fyJ0EDO9PQ', name: '被工具（Goland）坑的最惨的一次'},
          {url: 'https://mp.weixin.qq.com/s/45zu-OcP5UNbLdj5X3hUwA', name: '做一个会偷懒的程序员'},
          {url: 'https://mp.weixin.qq.com/s/VJIFYZchRjEzC2bzVladmw', name: 'idea定制groovy脚本，导出db数据到csv自动加行号和标题'},
          {url: 'https://mp.weixin.qq.com/s/rn2IbAWIpRVRE631hPNUfg', name: '60行shell脚本快速生成Java项目脚手架'},
          {url: 'https://mp.weixin.qq.com/s/iDA08QqL9xp3eo5znjWleA', name: '用docker快速搭建elk日志平台'},
          {url: 'https://mp.weixin.qq.com/s/1m7OKcqOcB2e_2K_mFG_8A', name: '50行go实现tree命令'},
          {url: 'https://mp.weixin.qq.com/s/EgE_sF8xmDfrkkX_zsdycA', name: '错怪Mybatis, 原来这并不是bug'},
          {url: 'https://mp.weixin.qq.com/s/h-ZrmzfRjhdsxfZneMyvuw', name: '注解+代理 加持分布式锁，让代码更简洁'},
          {url: 'https://mp.weixin.qq.com/s/kuJnTjMxdPv32E7a-r-zRQ', name: 'DIY插件，自动生成set调用，解放双手'},
          {url: 'https://mp.weixin.qq.com/s/zm-f6ENkt93dU53K2mNVZg', name: 'Java回调、Lambda与Redis分布式锁新玩法'},
          {url: 'https://mp.weixin.qq.com/s/_JCRYeo65c9CTklhqUJZBA', name: '巨烧脑-估计没几人能看懂:实现tree命令 - 探索你D盘的秘密'},
          {url: 'https://mp.weixin.qq.com/s/BFU-IHHg422aHZX-c0_3IQ', name: '基于shiro的权限自动录入'},
          {url: '', name: ''},
          {url: 'https://mp.weixin.qq.com/s/gjpqdLBuMlvzkdY_qHI54A', name: '南天门上，三千忠魂奋孤勇；祭旗坡下，一腔热血照青山'},
          {url: '', name: ''},
          {url: 'https://mp.weixin.qq.com/s/a9gXbNS_U3JMvzaaKvdkrA', name: '2020年5月，比特币即将迎来第三次减半，为什么比特币会减半'},
          {url: 'https://mp.weixin.qq.com/s/O04kd9SIvZcKHIRpHVz8Bw', name: '不小心敲了 rm -rf / 后反应是怎样的？'},
          {url: 'https://mp.weixin.qq.com/s/T-IMeuMTgwC7ZIpYAo2EEQ', name: '星际穿越的完全解析'},
          {url: 'https://mp.weixin.qq.com/s/D0RA8dv3e0_oDTdiN8CK8w', name: '奇记｜生死荒原路，52天首次单人完整横穿大羌塘'},
          {url: '', name: ''},]
      }, {
        title: "实用小工具",
        custom: true,
        background: "22e674",
        tools: [
          {url: '.', name: '主页'},
          {url: './calendar', name: '万年历'},
          {url: './format', name: 'JSON-格式化'},
          {url: 'http://tool.oschina.net/codeformat/xml', name: '其他代码格式化'},
          {url: 'http://cron.qqe2.com/', name: '在线Cron表达式生成器'},
          {url: 'http://tool.chinaz.com/tools/unicode.aspx', name: 'Unicode编码'},
          {url: 'http://www.bejson.com/xml2json/', name: 'XML 2 JSON'},
          {url: './json2bean', name: 'JSON 2 BEAN'},
          {url: './encrypt/encrypt.html', name: 'AES-DES'},
          {url: 'http://tool.chacuo.net/cryptaes', name: 'AES-2'},
          {url: './encrypt/encrypt2.html', name: '哈希散列'},
          {url: 'https://tool.lu/hexconvert/', name: '进制转换'},
          {url: './encrypt/encrypt3.html', name: 'BASE64编码'},
          {url: './encrypt/encrypt4.html', name: '图片转base64'},
          {url: 'https://c.runoob.com/front-end/59/', name: '图片BASE64编码'},
          {url: 'https://cli.im/', name: '二维码生成器'},
          {url: 'http://www.jq22.com/textDifference', name: 'Show diff'},
          {url: 'http://tool.oschina.net/jscompress/', name: 'js/css compresss'},
          {url: 'http://imgbase64.duoshitong.com/', name: '图片 base64 互转'},
          {url: 'https://www.ip.cn', name: 'IP 域名地址查询'},
          {url: 'https://github.com/qjyoung', name: 'qjyoung-github'},
          {url: 'https://blog.csdn.net/qq_33303700', name: 'qjyoung-CSDN'},
          {url: 'https://www.bootcdn.cn/', name: '开源项目CDN'},
          {url: 'http://www.yuangongju.com/css3button', name: 'css-button'},
          {url: 'http://www.jq22.com/webqd5122', name: 'css-input'},
          {url: 'https://www.processon.com/', name: 'processon'},
          {url: 'http://www.txttool.com/WenBen_Sort4.asp', name: '在线字典排序'},
        ]
      }],
      countdown: {
        title: "倒计时",
        background: "FFE56F",
        type: type_countdown,
        today: '',
        tools: [{
          date: "xxxx-09-16",
          desc: "公历生日",
          custom: true
        }, {
          lunarDate: "xxxx-八-十二",
          isLunar: true,
          date: "xxxx-09-16",
          desc: "农历生日",
          custom: true
        }]
      }
    },
    mounted() {
      // this.checkHolidays();
      let doc = this.toolGroups[0];
      this.toolGroups = this.getFromLocal("toolGroups", this.toolGroups);
      this.toolGroups[0] = doc;
      this.countdown = this.getFromLocal("countdown", this.countdown);
      this.reloadCountDown();
      setInterval(this.reloadCountDown, 1000 * 60 * 5);
    },
    methods: {
      getFromLocal(key, field) {
        let cache = JSON.parse(localStorage.getItem(key));
        if (cache != null) {
          return cache;
        }
        return field;
      },
      reloadCountDown() {
        this.checkHolidays();

        this.countdown.today = `<span style="font-size:14pt;text-align:center;float: left;height:156px;width: 150px;border:2px solid #0da0ec;"> ${getDate(new Date())} </span>`;

        let tools = this.countdown.tools;
        let today = new Date();
        let year = today.getFullYear();
        let month = today.getMonth();
        let day = today.getDate();
        today = new Date(year, month, day);
        month += 1;
        let lastDiff = 0;
        for (let i = 0; i < tools.length; i++) {
          let item = tools[i];
          if (!item.date) {
            tools[i] = {
              custom: item.custom || false,
              diff: lastDiff + 0.00001
            };
            continue
          }
          let strings = item.isLunar ? item.lunarDate.split('-') : item.date.split('-');
          let _year = strings[0], _month = strings[1], _day = strings[2];
          _year = _year === 'xxxx' ? year : _year;
          if ('xx' === _month) {
            _month = month;
            if (day >= parseInt(_day)) {
              if (month === 12 && strings[0] === 'xxxx') {
                _year = year + 1;
                _month = 1;
              } else {
                _month = month + 1;
              }
            }
          }
          let date, name;
          if (item.isLunar) {
            let yearBeginTime = new Date(_year, today.getMonth(), 1).getTime();
            let found = false;
            for (let j = 0; j < 366; j++) {
              let theDate = new Date(yearBeginTime + 86400000 * j);
              let lunar = new Lunar(theDate);
              if (lunar.chineseMonth === _month && lunar.chineseDay === _day) {
                found = true;
                date = lunar.dateString;
                name = lunar.dateString.replace(year + "-", "") + ' ';
                name += lunar.chineseMonth + '月' + lunar.chineseDay;
                break
              }
            }

            if (!found) {
              if (strings[0] !== 'xxxx') {
                tools.splice(i, 1);
                i--;
              }
              // TODO show hide
              continue;
            }
          } else {
            date = [_year, _month, _day].join('-');
            name = date.replace(year + "-", "");
          }
          let diff = (new Date(date).getTime() - today.getTime()) / 1000 / 3600 / 24;
          if (diff < 0) {
            tools.splice(i, 1);
            i--;
            continue
          }
          lastDiff = diff;

          name = name.replace(_year + "年", '');
          tools[i] = {
            date: item.date,
            lunarDate: item.isLunar ? item.lunarDate : '',
            isLunar: item.isLunar,
            desc: item.desc,
            custom: item.custom || false,
            diff: diff,
            name: name + "\t<strong style='color: black'>" + item.desc + "</strong>\t" + Math.floor(diff) + "天"
          };
        }
        tools.sort(function (a, b) {
          let res = a.custom - b.custom;
          if (res !== 0) {
            return res;
          }
          return a.diff - b.diff;
        });
        localStorage.setItem("countdown", JSON.stringify(this.countdown));
      },
      checkHolidays() {
        let this0 = this;
        let today = new Date();
        let date = today.getDate();
        // let localDate = localStorage.getItem("date");
        // if (date !== undefined && localDate === date + "") {
        //   return
        // }
        let holidays = [];

        let yearBeginTime = new Date(today.getFullYear(), today.getMonth(), 1).getTime();
        for (let j = 0; j < 366; j++) {
          let theDate = new Date(yearBeginTime + 86400000 * j);
          let lunar = new Lunar(theDate);
          let _festivals = festivals(lunar)
          _festivals.forEach(value => {
            if (value.festival.indexOf("*") > 0) {
              holidays.push({
                date: lunar.dateString,
                lunarDate: ['xxxx', lunar.chineseMonth, lunar.chineseDay].join('-'),
                isLunar: value.isLunar,
                desc: value.festival.replace('*', '')
              });
            }
          })
        }
        holidays.push({})

        let tools = this0.countdown.tools.filter(item => {
          return item.custom
        })
        this0.countdown.tools = [...tools, ...holidays];
        localStorage.setItem("date", date);
      },
    },
    watch: {
      toolGroups: {
        handler(groups) {
          localStorage.setItem("toolGroups", JSON.stringify(groups));
        },
        deep: true
      },
      "countdown.tools.length": {
        handler(val) {
          this.reloadCountDown();
        }
      }
    }
  })
</script>
</html>
